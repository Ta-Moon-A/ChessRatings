<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




</head>

<body translate="no">

    <div class="container centered">
        <div id="myGraph"></div>
    </div>
    <script src="libs/d3.v4.min.js"></script>
    <script src="scripts/d3script.js"></script>
    <script src="scripts/tooltip.js"></script>

    <script>
        var dummyData = [{
            "id": "nikodz",
            "isOnline": true,
            "username": "nikodz",
            "blitzrating": 2500,
            "bulletrating": 1500,
            "classicalrating": 500,
            "fullname": "ნიკო ძნელაძე",
            "unit": "internal"
        },
        {
            "id": "katamarani4",
            "isOnline": false,
            "username": "katamarani4",
            "blitzrating": 1880,
            "bulletrating": 1664,
            "classicalrating": 1614,
            "fullname": "გრიშა",
            "unit": "internal"
        },

        {
            "id": "mrx1313",
            "isOnline": true,
            "username": "mrx1313",
            "blitzrating": 1110,
            "bulletrating": 1500,
            "classicalrating": 1421,
            "fullname": "პაპუნა მიშვიძე",
            "unit": "internal"
        },
        // {
        //     "id": "tamart",
        //     "isOnline": false,
        //     "username": "tamart",
        //     "blitzrating": 1500,
        //     "bulletrating": 995,
        //     "classicalrating": 1663,
        //     "fullname": "თამო",
        //     "unit": "internal"
        // },
        {
            "id": "bumbeishvili",
            "isOnline": false,
            "username": "bumbeishvili",
            "blitzrating": 1509,
            "bulletrating": 1431,
            "classicalrating": 1609,
            "fullname": "დათო ბუმბეიშვილი",
            "unit": "internal"
        },
        {
            "id": "wisemanika",
            "isOnline": false,
            "username": "wisemanika",
            "blitzrating": 1338,
            "bulletrating": 1146,
            "classicalrating": 1102,
            "fullname": "ირაკლი ქიქავა",
            "unit": "internal"
        },
        {
            "id": "chaak",
            "isOnline": false,
            "username": "Chaak",
            "blitzrating": 976,
            "bulletrating": 1500,
            "classicalrating": 1500,
            "fullname": "ნიკა ჩაკვეტაძე",
            "unit": "internal"
        },
        {
            "id": "chiquitita",
            "isOnline": true,
            "username": "chiquitita",
            "blitzrating": 1500,
            "bulletrating": 1500,
            "classicalrating": 1090,
            "fullname": "თამარ ტაკიძე",
            "unit": "qc"
        }];


        var ratingCategories = [{ name: "bulletrating", desc: "BULLET" },
                                { name: "blitzrating", desc: "BLITZ" },
                                { name: "classicalrating", desc: "CLASSICAL" }];

        var data = {
            users: {
                nikodz: {
                    fullname: "ნიკო ძნელაძე",
                    unit: 'internal'
                }, katamarani4: {
                    fullname: "გრიშა",
                    unit: 'internal'
                }, mrx1313: {
                    fullname: "პაპუნა მიშვიძე",
                    unit: 'digital'
                },
                tamart: {
                    fullname: "თამო",
                    unit: 'digital'
                },
                bumbeishvili: {
                    fullname: "დათო ბუმბეიშვილი",
                    unit: 'core'
                },
                wisemanika: {
                    fullname: "ირაკლი ქიქავა",
                    unit: 'core'
                },
                Chaak: {
                    fullname: "ნიკა ჩაკვეტაძე",
                    unit: 'qc'
                },
                chiquitita: {
                    fullname: "თამარ ტაკიძე",
                    unit: 'qc'
                }
                // ,
                //  kuzana: {
                //     fullname: "გიორგი კუზანაშვილი",
                //     unit: 'qc'
                // }
            }
        };


        // d3.xhr("https://lichess.org/api/users")
        //     .header("Content-Type", "application/json")
        //     .post( Object.keys(data.users).join(), function (err, rawData) {


        //     });

        // d3.request("https://lichess.org/api/users").send("GET",  `"${Object.keys(data.users).join()}"`, function(err, rawData)
        // {
        //     debugger;
        //       var result = JSON.parse(rawData);


        // });

        //--------------------------- make queue for lichess calls ---------------------------
        // var queue = d3.queue();
        // Object.keys(data.users).forEach(username => {
        //     queue.defer(d3.json, "https://lichess.org/api/user/" + username)
        // })

        // queue.awaitAll(ready);

        // function ready(err, result) {
        //     console.log(arguments)


        //      data.result = result.map(function (d) {
        //             return {
        //                 id: d.id,
        //                 isOnline: d.online,
        //                 username: d.username,
        //                 blitzrating: d.perfs.blitz.rating,
        //                 bulletrating: d.perfs.bullet.rating,
        //                 classicalrating: d.perfs.classical.rating,
        //                 fullname: data.users[d.username].fullname,
        //                 unit: data.users[d.username].unit
        //             }
        //         });
        // }
        // ---------------------------------------------------------------------------------------





        data.result = dummyData;
        data.ratingCategories = ratingCategories;
        data.units = ["internal", "qc", "digital", "core"];

        // console.log("result  ");
        // console.log(data.result);

        var chart = renderChart()
            .svgHeight(window.innerHeight - 30)
            .svgWidth(window.innerWidth - 30)
            .container('#myGraph')
            .data(data)
            .debug(true)
            .run()


        //------------------------------------------------------
    </script>


</body>

</html>